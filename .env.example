## Autoscaling
COMPOSE_PROJECT_NAME=n8n-autoscaling
# Logging level for autoscaler and monitor (DEBUG, INFO, WARNING, ERROR)
# Use DEBUG to see detailed diagnostics (queue polling, container counts, cooldown status)
# Use INFO for production (only logs events: scaling actions, queue activity, errors)
LOG_LEVEL=INFO
COMPOSE_FILE_PATH=/app/docker-compose.yml
GENERIC_TIMEZONE=America/New_York
MIN_REPLICAS=1
MAX_REPLICAS=5
SCALE_UP_QUEUE_THRESHOLD=5
SCALE_DOWN_QUEUE_THRESHOLD=1
POLLING_INTERVAL_SECONDS=10
COOLDOWN_PERIOD_SECONDS=10
POLL_INTERVAL_SECONDS=5
N8N_QUEUE_BULL_GRACEFULSHUTDOWNTIMEOUT=300
N8N_GRACEFUL_SHUTDOWN_TIMEOUT=300

## Redis
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=YOURREDISPASSWORD  # Change this to a strong password
QUEUE_NAME_PREFIX=bull
QUEUE_NAME=jobs
QUEUE_BULL_REDIS_HOST=redis
QUEUE_HEALTH_CHECK_ACTIVE=true

## Postgres - Admin (superuser for database management)
POSTGRES_HOST=postgres
POSTGRES_ADMIN_USER=postgres
POSTGRES_ADMIN_PASSWORD=YOURADMINPASSWORD  # Change this to a strong password
PGDATA=/var/lib/postgresql/data/pgdata
DB_TYPE=postgresdb

## Postgres - Application (limited-privilege user for n8n)
# These credentials are used by n8n to connect to the database.
# The init-postgres.sh script creates this user with restricted privileges.
# Set POSTGRES_APP_PASSWORD to enable user separation; leave empty to use the admin user directly.
POSTGRES_DB=n8n
POSTGRES_USER=n8n_app
POSTGRES_PASSWORD=YOURAPPPASSWORD  # Change this to a strong password
POSTGRES_APP_DB=n8n
POSTGRES_APP_USER=n8n_app
POSTGRES_APP_PASSWORD=YOURAPPPASSWORD  # Must match POSTGRES_PASSWORD above

## N8N
N8N_HOST=n8n.domain.com # Change this
N8N_WEBHOOK=webhook.domain.com # Change this
N8N_WEBHOOK_URL=https://webhook.domain.com # Change this
WEBHOOK_URL=https://webhook.domain.com # Change this
N8N_EDITOR_BASE_URL=https://n8n.domain.com # Change this
N8N_PROTOCOL=https
N8N_PORT=5678
N8N_DIAGNOSTICS_ENABLED=false
N8N_USER_FOLDER=/n8n/main
N8N_SECURE_COOKIE=false
N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=false
N8N_ENCRYPTION_KEY=YOURKEY # 32 characters MAKE YOUR OWN KEY
N8N_USER_MANAGEMENT_JWT_SECRET=YOURKEY # Change this to a strong password
N8N_WORKER_SERVICE_NAME=n8n-worker
N8N_WORKER_RUNNER_SERVICE_NAME=n8n-worker-runner
EXECUTIONS_MODE=queue
OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true

## Task Runner config (n8n 2.0 - external mode)
# Task runners are separate containers in n8n 2.0
# Each worker gets its own task runner sidecar (scaled 1:1 by the autoscaler)
# The main n8n instance does NOT need a task runner because all executions
# are offloaded to workers (OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true)
# Security settings are configured in n8n-task-runners.json
N8N_RUNNERS_MODE=external
N8N_RUNNERS_BROKER_LISTEN_ADDRESS=0.0.0.0
N8N_RUNNERS_AUTH_TOKEN=YOURPASSWORD # Change this to a strong password
N8N_RUNNERS_TASK_BROKER_URI=http://n8n:5679
N8N_RUNNERS_MAX_CONCURRENCY=5
N8N_RUNNERS_AUTO_SHUTDOWN_TIMEOUT=15

## Code node external packages
# Packages allowed in n8n Code nodes (must also be installed in Dockerfile.runner)
# Available packages: ajv, ajv-formats, puppeteer-core, puppeteer-extra, puppeteer-extra-plugin-stealth, playwright-core, playwright-extra
# Puppeteer and Playwright are pre-configured with chromium in the task runner image
NODE_FUNCTION_ALLOW_EXTERNAL=ajv,ajv-formats,puppeteer-core,puppeteer-extra,puppeteer-extra-plugin-stealth,playwright-core,playwright-extra
PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser

## Community Nodes
# Enable installing community nodes from the n8n UI
N8N_COMMUNITY_PACKAGES_ENABLED=true
# Allow all community nodes (set to specific packages to restrict)
N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=true

## Data limits
N8N_DATA_TABLES_MAX_SIZE_BYTES=1048576000  # 1GB in bytes, adjust as needed
N8N_BLOCK_ENV_ACCESS_IN_NODE=false

## Cloudflare Tunnel
CLOUDFLARE_TUNNEL_TOKEN=YOURTOKEN

## Docker Socket (Optional - for rootless Docker)
# Default: /var/run/docker.sock (standard Docker)
# For rootless Docker, set to: /run/user/1000/docker.sock (replace 1000 with your UID)
# Find your UID with: id -u
#DOCKER_SOCK=/run/user/1000/docker.sock

## Tailscale (Optional)
TAILSCALE_IP=
# Change this to your Tailscale IP (find with: tailscale ip -4)
# This binds n8n, postgres, and redis ports to your Tailscale network only for secure private access
# When empty, all ports default to 127.0.0.1 (localhost only)

## Log Rotation
# Configure Docker log rotation for all services
#LOG_DRIVER=json-file
#LOG_MAX_SIZE=10m
#LOG_MAX_FILE=3

## Backup (Optional)
# To enable backups, uncomment the following line (or add "backup" to COMPOSE_PROFILES)
#COMPOSE_PROFILES=backup
# Cron schedule for automated backups (default: daily at 2 AM)
BACKUP_SCHEDULE=0 2 * * *
# Number of days to retain old backups on remote storage
BACKUP_RETENTION_DAYS=30
# GPG passphrase for encrypting backups (leave empty to disable encryption)
BACKUP_ENCRYPTION_KEY=
# Comma-separated rclone remote destinations (e.g., "r2:my-bucket/n8n,s3:backup-bucket/n8n")
# Configure remotes in backup/rclone.conf (see backup/rclone.conf.example)
BACKUP_RCLONE_DESTINATIONS=
# Run a backup immediately on container start (useful for testing)
BACKUP_RUN_ON_START=false
# Delete local backup files after successful remote upload (set to true to save disk space)
BACKUP_DELETE_LOCAL_AFTER_UPLOAD=false
# Email notifications (all optional - leave empty to disable)
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_TO=
# Webhook URL for backup notifications (optional - posts JSON payload on success/failure)
BACKUP_WEBHOOK_URL=

## ============================================================
## Performance Tuning (Optional - uncomment to override defaults)
## ============================================================
## Adjust these based on your server resources and workload.
## See README.md for workload tier guidance.

## n8n Performance
#N8N_CONCURRENCY_PRODUCTION_LIMIT=20         # Max concurrent workflow executions
#EXECUTIONS_DATA_PRUNE=true                   # Auto-prune old execution data
#EXECUTIONS_DATA_MAX_AGE=168                  # Hours to keep execution data (168 = 7 days)
#EXECUTIONS_DATA_PRUNE_MAX_COUNT=50000        # Max execution records to keep
#NODE_OPTIONS=--max-old-space-size=4096       # Node.js heap size in MB

## PostgreSQL Performance (set via POSTGRES_INITDB_ARGS or custom postgresql.conf)
## These are guidelines - actual values depend on available RAM
# Light workload (2-4GB RAM):   shared_buffers=256MB, work_mem=4MB
# Medium workload (8-16GB RAM): shared_buffers=1GB, work_mem=16MB
# Heavy workload (32GB+ RAM):   shared_buffers=4GB, work_mem=64MB, effective_cache_size=24GB

## Redis Performance
#REDIS_MAXMEMORY=256mb                        # Max memory for Redis (set based on available RAM)
#REDIS_MAXMEMORY_POLICY=allkeys-lru           # Eviction policy when maxmemory is reached
