# Podman rootless override - Adds SELinux relabeling (:Z) and user namespace ownership (:U)
# Required for rootless Podman where container UIDs don't match host UIDs.
#
# Usage: docker compose -f docker-compose.yml -f docker-compose.podman.yml up -d

services:
  redis:
    volumes:
      - redis_data:/data:Z,U

  postgres:
    volumes:
      - postgres_data:/var/lib/postgresql/data:Z,U
      - ./init-pgvector.sql/init.sql:/docker-entrypoint-initdb.d/01-init-pgvector.sql:Z
      - ./init-postgres.sh:/docker-entrypoint-initdb.d/02-init-postgres.sh:Z

  n8n:
    volumes:
      - n8n_main:/n8n:Z,U

  n8n-webhook:
    volumes:
      - n8n_webhook:/n8n:Z,U

  n8n-worker:
    volumes:
      - n8n_main:/n8n:Z,U

  n8n-backup:
    volumes:
      - n8n_main:/data/n8n_main:ro,Z,U
      - n8n_webhook:/data/n8n_webhook:ro,Z,U
      - redis_data:/data/redis:ro,Z,U
      - backup_data:/backups:Z,U

  n8n-autoscaler:
    volumes:
      - ${DOCKER_SOCK:-/run/user/1000/podman/podman.sock}:/var/run/docker.sock:Z
      - ./.env:/app/.env:Z
